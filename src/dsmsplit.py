import re
from pathlib import Path
import os
import pandas as pd

f = open("../data/input/ClinicalCases.txt", "r")
text = f.read()
cases = re.split("Case [0-9].*",text)
for i in range (len(cases)):
    if i==0:
            continue
    iDiscussion = cases[i].index("Discussion")
    try:
        iDiagnosis = cases[i].index("Diagnoses")
    except:
        iDiagnosis = cases[i].index("Diagnosis")  
    introduzione = cases[i][0:iDiscussion].replace('\n','')
    discussione = cases[i][iDiscussion:iDiagnosis].replace('\n','')
    diagnosi = cases[i][iDiagnosis:].replace('\n','')
    with open("../data/input/splitCases.csv", "a", encoding="utf-8") as outputFile:
                    outputFile.write(f"{i}§{introduzione}§{discussione}§{diagnosi}\n")
    

output_file_path = "../data/input/splitCases.csv"
df = pd.read_csv(output_file_path, sep='§', header=None, names=["Case_Number", "Introduction", "Discussion", "Diagnosis"])
df = df.iloc[1:].reset_index(drop=True)
df_gemma2latest = pd.read_csv("data/output/gemma2latest/answers-cases.csv", sep='§', engine='python')
df_gemma227b = pd.read_csv("data/output/gemma227b/answers-cases.csv", sep='§', engine='python')
df_llama3latest = pd.read_csv("data/output/llama3latest/answers-cases.csv", sep='§', engine='python')
df_mistral_nemolatest = pd.read_csv("data/output/mistral-nemolatest/answers-cases.csv", sep='§', engine='python')
df_mixtral8x7b = pd.read_csv("data/output/mixtral8x7b/answers-cases.csv", sep='§', engine='python')
df_phi35latest = pd.read_csv("data/output/phi3.5latest/answers-cases.csv", sep='§', engine='python')
df_phi3medium = pd.read_csv("data/output/phi3medium/answers-cases.csv", sep='§', engine='python')

df["Question"]=df_phi3medium["quesion"]

dfs = [
    df_gemma2latest,
    df_gemma227b,
    df_llama3latest,
    df_mistral_nemolatest,
    df_mixtral8x7b,
    df_phi35latest,
    df_phi3medium
]

column_names = [
    "gemma2latest_answer",
    "gemma227b_answer",
    "llama3latest_answer",
    "mistral_nemolatest_answer",
    "mixtral8x7b_answer",
    "phi35latest_answer",
    "phi3medium_answer"
]
for df_source, column_name in zip(dfs, column_names):
    df[column_name] = df_source['answer']
l= [
    """Based on the information provided in this case study and using the ICD-11 classification system, a potential diagnosis for Brandon could be:\n\n6A02 Autism spectrum disorder\n\nSpecifically, this diagnosis is supported by several key features described in the case:\n\n1. Persistent deficits in social communication and social interaction:\n   - Difficulty making friends and mistrusting peers\' intentions\n   - Below-average eye contact\n   - Struggles with jokes and typical adolescent banter\n   - Taking things literally\n   - General avoidance of socializing\n\n2. Restricted, repetitive patterns of behavior, interests, or activities:\n   - Intense focus on trucks, cars, and trains since an early age\n   - Bringing toy vehicles to school\n   - Being a "stickler for routine"\n\n3. Symptoms present from early childhood:\n   - Always been "very shy" and never had a best friend\n   - Early focus on vehicles\n\n4. Symptoms causing significant impairment in social and academic functioning:\n   - Declining school performance\n   - Difficulties interacting with peers\n   - Reluctance to attend school\n\nAdditional features that support this diagnosis include:\n\n- Sensory sensitivities (e.g., "I hate loud noises")\n- Difficulty understanding social cues and interpreting others\' intentions\n- Attempts to mask autistic traits ("tries to appear \'normal\'")\n- Family history (father with similar traits)\n\nIt\'s important to note that Brandon is also experiencing symptoms of anxiety and depression, which are common co-occurring conditions in individuals with autism spectrum disorder. These include:\n\n- Anxiety: stomachaches on school mornings, feeling nervous around peers\n- Depression: saying he sometimes wished he had never been born, appearing sad\n\nAdditionally, Brandon\'s speech difficulties (stumbling over words, pausing excessively, repeating words) might suggest a co-occurring speech disorder, possibly 6A01.1 Developmental speech fluency disorder (stuttering).\n\nWhile this diagnosis of autism spectrum disorder seems most fitting based on the ICD-11 criteria and the information provided, it\'s crucial to emphasize that a comprehensive clinical assessment would be necessary to confirm this diagnosis and rule out other possibilities. The assessment should also consider Brandon\'s strengths and specific support needs to develop an appropriate treatment plan.""",
    """Based on the information provided and using the ICD-11 classification system, a comprehensive diagnosis for Carlos could include:\n\n1. 6A03 Developmental learning disorder\n   - Specifically, 6A03.0 Developmental learning disorder with impairment in reading\n   - And 6A03.1 Developmental learning disorder with impairment in written expression\n\nThis is supported by:\n- History of reading problems, particularly in fluency and comprehension\n- Current difficulties with reading, writing, and spelling\n- These difficulties are not attributable to intellectual developmental disorder, sensory issues, or language proficiency\n\n2. 6A05 Attention deficit hyperactivity disorder\n   - Specifically, 6A05.2 Attention deficit hyperactivity disorder, combined presentation\n\nThis is supported by:\n- Childhood diagnosis of ADHD, combined type\n- Ongoing difficulties with focus, task completion, and organization\n- Restlessness and agitation\n\n3. 6B01 Generalized anxiety disorder\n\nThis is supported by:\n- Persistent worry about academic performance\n- Difficulty managing anxiety\n- History of "nervousness" (ataque de nervios)\n- Recent panic-like episodes in social situations\n\n4. 6A80 Autism spectrum disorder (consider as a differential diagnosis)\n\nWhile not explicitly diagnosed, some features suggest the need to consider ASD:\n- Early language delay\n- Intense focus on specific interests (video games)\n- Social difficulties in college\n- Sensory sensitivities (pulling hoodie over face)\n\n5. MB23.E Adjustment disorder\n\nThis could be considered due to:\n- Difficulties adjusting to the college environment\n- Symptoms of anxiety and depression related to this transition\n\n6. 6B04 Depressive episode\n\nConsider as a possible comorbidity due to:\n- Feelings of hopelessness\n- Poor concentration\n- Insomnia\n- Low energy\n- Anhedonia ("inability to have fun")\n\nIt\'s important to note that Carlos is also dealing with several psychosocial factors that, while not diagnoses themselves, are crucial to consider in his overall assessment:\n\n- Acculturation stress (being the only Dominican in his college environment)\n- Identity development issues (questioning sexual orientation)\n- Academic pressure (being the first in his family to attend college)\n\nA comprehensive clinical assessment would be necessary to confirm these diagnoses and rule out other possibilities. The treatment plan should address not only the specific disorders but also Carlos\'s psychosocial stressors and cultural context. Additionally, it would be beneficial to explore supports and accommodations available through the university\'s disability services to help Carlos manage his learning difficulties.""",
    """Based on the information provided and using the ICD-11 classification system, a diagnosis for Daphne could include:\n\n1. 6B06 Generalized anxiety disorder\n\nThis is the primary diagnosis, supported by:\n- Persistent worry and fear about various aspects of life (school performance, social interactions, decision-making)\n- Difficulty falling asleep since early childhood\n- Easily upset by change\n- Tense and shy in new situations\n- Preoccupation with making mistakes and disappointing others\n- Difficulty relaxing in social situations\n\n2. 6B44 Selective mutism\n\nThis diagnosis should be considered due to:\n- Being quiet in groups and at school, but more interactive with family members and individuals she knows well\n- Difficulty talking in the initial part of the evaluation, which improved as she became more comfortable\n\n3. 6A02 Autism spectrum disorder (consider as a differential diagnosis)\n\nWhile not explicitly diagnosed, some features suggest the need to consider ASD:\n- Poor eye contact\n- Difficulty with social interactions and making new friends\n- Preference for playing with younger children\n- Intense interest in specific topics (plastic horse collection)\n- Difficulty with changes in routine\n- Sensory sensitivities (requiring a nightlight)\n\n4. 6A05 Attention deficit hyperactivity disorder\n\nThis was previously diagnosed by her pediatrician, but the current presentation is less clear. Some symptoms that might support this diagnosis include:\n- Difficulty starting and completing schoolwork\n- Trouble following instructions\n- However, these symptoms might also be explained by anxiety\n\n5. 6A03.2 Developmental learning disorder with impairment in mathematics\n\nThis should be considered due to:\n- Failing grades specifically in math\n- Difficulties in visuospatial skills noted in psychological testing\n\nIt's important to note that Daphne is also dealing with several psychosocial factors that, while not diagnoses themselves, are crucial to consider in her overall assessment:\n\n- Low self-esteem\n- Social difficulties and possible bullying at school\n- Academic stress\n- Onset of puberty (recent start of menses)\n\nA comprehensive clinical assessment would be necessary to confirm these diagnoses and rule out other possibilities. The treatment plan should address not only the specific disorders but also Daphne's psychosocial stressors and developmental stage. \n\nIt's worth noting that while Daphne has some symptoms that could suggest depression (sadness, low self-esteem), she denied persistent depressive feelings or suicidal thoughts. However, her mood should be monitored closely as part of ongoing care.\n\nThe treatment approach should be multifaceted, potentially including cognitive-behavioral therapy for anxiety, social skills training, academic support (particularly for math), and family therapy to address parental responses to Daphne's anxiety. A careful re-evaluation of the potential benefits and risks of medication (including both stimulants and anti-anxiety medications) might also be warranted""",
    """Based on the information provided and using the ICD-11 classification system, a diagnosis for Ethan could include:\n\n1. 8A05.0 Tourette syndrome\n\nThis is supported by:\n- Multiple motor tics (shoulder shrugging, grimacing, blinking)\n- At least one vocal tic (throat-clearing noises)\n- Tics have been present for more than a year (implied by the description of recent changes)\n- Onset during developmental period (before 18 years old)\n\n2. 6B05 Obsessive-compulsive disorder\n\nThis is suggested by:\n- Compulsive behavior (touching doorjambs in a specific pattern)\n- Described as "superstitious" behavior\n- These behaviors are causing noticeable distress or impairment\n\n3. 6B06 Generalized anxiety disorder\n\nThis diagnosis is supported by:\n- Worrying about "bad things" happening to his parents\n- Uneasiness about being left alone\n- Clinginess and following parents around the house\n- Refusing to go on sleepovers\n- Frequent visits to the school nurse complaining of stomachaches (possibly psychosomatic)\n\n4. 6B05 Separation anxiety disorder \n\nThis should be considered due to:\n- Difficulty being alone\n- Climbing into parents\' bed at night\n- Refusal to go on sleepovers\n- Clinginess and following parents around\n\n5. 6A05 Attention deficit hyperactivity disorder (consider as a differential diagnosis)\n\nWhile some symptoms might suggest ADHD, they could also be explained by anxiety or tics:\n- Flagging attention at school\n- Fidgetiness\n- Distractibility when work becomes challenging\n\nIt\'s important to note that Ethan is also experiencing some mood changes (looking weepy) which, while not meeting full criteria for a mood disorder, should be monitored.\n\nA comprehensive clinical assessment would be necessary to confirm these diagnoses and rule out other possibilities. The treatment plan should address not only the specific disorders but also Ethan\'s academic performance and family dynamics. \n\nThe treatment approach should be multifaceted, potentially including cognitive-behavioral therapy for OCD and anxiety, habit reversal training for tics, and family therapy to address parental responses to Ethan\'s symptoms. A careful evaluation of the potential benefits and risks of medication might also be warranted, particularly for the tics and OCD symptoms if they are causing significant distress or impairment.""",
    """Based on the information provided and using the ICD-11 classification system, a diagnosis for Felicia Allen could include:\n\n1. 6A20 Schizophrenia\n\nThis is the primary diagnosis, supported by:\n- Long-standing history of "childhood-onset, treatment-resistant paranoid schizophrenia"\n- Auditory hallucinations since age 5\n- Paranoid thoughts\n- Chronic course requiring almost constant hospitalization since age 11\n- Concrete thinking\n- Improved functioning with antipsychotic medication (clozapine)\n\n2. 6A20.0 Schizophrenia, currently symptomatic\n\nWhile her symptoms have improved with clozapine, she still displays:\n- Possible hallucinations or delusions (mumbling to herself)\n- Disorganized behavior (attempting to steal a bus)\n- Impaired reality testing\n\n3. 6A40 Disorders of intellectual development\n\nThis should be considered due to:\n- Childhood onset of symptoms\n- Concrete thinking\n- Limited experience with the real world\n- Difficulties with social and adaptive functioning\n\n4. 6E60 Secondary neurodevelopmental syndrome\n\nThis could be considered due to the early onset of schizophrenia potentially impacting her neurodevelopment.\n\n5. 6B21 Schizoaffective disorder (differential diagnosis)\n\nWhile not explicitly mentioned, this should be considered as a differential diagnosis given the long-standing nature of her symptoms and potential mood components.\n\n6. 6C4Y Other specified disorders due to addictive behaviors\n\nThe significant weight gain (35 pounds) on clozapine might indicate a need to monitor for potential food addiction or binge eating behaviors.\n\nIt\'s important to note several additional factors that, while not diagnoses themselves, are crucial to consider in Ms. Allen\'s overall assessment and treatment plan:\n\n- Long-term institutionalization effects\n- Limited social skills and real-world experience\n- Ongoing need for social remediation and life skills training\n- Medication side effects (weight gain from clozapine)\n- Potential legal issues stemming from the bus incident\n\nA comprehensive clinical assessment would be necessary to confirm these diagnoses and rule out other possibilities. The treatment plan should address not only the specific disorders but also Ms. Allen\'s psychosocial needs, including:\n\n- Continued antipsychotic medication management\n- Psychosocial rehabilitation\n- Life skills training\n- Supported employment and housing options\n- Weight management and metabolic monitoring\n- Legal advocacy\n\nThe goal should be to continue supporting Ms. Allen\'s progress towards greater independence while managing her symptoms and addressing her developmental and social needs.""",
    """Based on the information provided and using the ICD-11 classification system, a diagnosis for Gregory Baker could include:\n\n1. 6A20 Schizophrenia\n\nThis is the primary diagnosis, supported by:\n- Presence of positive symptoms: \n  - Delusions (paranoid, grandiose, and romantic)\n  - Possible hallucinations (mumbling to himself, though he denies hallucinations)\n- Negative symptoms:\n  - Social withdrawal\n  - Reduced emotional expression (appearing constricted)\n- Disorganized behavior:\n  - Odd behavior (standing on the roof, waving arms)\n  - Disrupting a classroom claiming to be "the Joker"\n- Decline in functioning:\n  - Academic suspension\n  - Social isolation\n- Duration of symptoms: at least several months\n- Absence of mood disorder or substance use that could better explain symptoms\n\n2. 6A20.0 Schizophrenia, first episode\n\nThis specifier is appropriate because:\n- This appears to be Mr. Baker\'s first contact with mental health services\n- No prior hospitalizations or psychiatric treatment\n\n3. 6A25 Acute and transient psychotic disorder (differential diagnosis)\n\nWhile schizophrenia seems more likely given the duration of symptoms, this should be considered as a differential diagnosis due to the apparently acute onset of more severe symptoms.\n\n4. 6A24 Delusional disorder (differential diagnosis)\n\nThis should be considered due to the prominence of delusions, but the presence of other schizophrenia symptoms makes this diagnosis less likely.\n\n5. 6A40 Disorders of intellectual development (to be ruled out)\n\nWhile there\'s no clear evidence of intellectual disability, his refusal of cognitive testing and disorientation to time suggest this should be evaluated.\n\nIt\'s important to note several additional factors that, while not diagnoses themselves, are crucial to consider in Mr. Baker\'s overall assessment and treatment plan:\n\n- Family history of mental illness (grandmother and mother)\n- Possible traumatic experiences (abandonment by mother)\n- Academic and social functioning decline\n- Lack of insight into his condition\n\nA comprehensive clinical assessment would be necessary to confirm these diagnoses and rule out other possibilities. The treatment plan should address:\n\n- Antipsychotic medication initiation\n- Psychoeducation for Mr. Baker and his family\n- Individual therapy to address delusional thinking and improve insight\n- Social skills training and vocational rehabilitation\n- Family therapy or support\n- Consideration of supported education to help him return to university\n- Regular monitoring for symptom changes and medication side effects\n\nThe goal should be to stabilize Mr. Baker\'s acute symptoms, improve his insight, and work towards restoring his previous level of academic and social functioning. Long-term management will be crucial given the likely diagnosis of schizophrenia.""",
    """Based on the information provided and using the ICD-11 classification system, a diagnosis for Hakim Coleman could include:\n\n1. 6A20 Schizophrenia\n\nThis is the primary diagnosis, supported by:\n- Positive symptoms:\n  - Auditory hallucinations ("hearing voices trying to make me feel guilty")\n  - Delusions (believing strangers are commenting on his past sins)\n- Negative symptoms:\n  - Blunted affect\n  - Social withdrawal\n- Disorganized behavior:\n  - Increased latency of speech\n- Duration of symptoms: at least 3 months\n- Decline in functioning:\n  - Academic performance decline (from straight As to Bs and Cs)\n  - Social isolation\n\n2. 6A20.0 Schizophrenia, first episode\n\nThis specifier is appropriate because this appears to be Mr. Coleman\'s first presentation with these symptoms.\n\n3. 6C40.1 Alcohol dependence, current use\n\nWhile Mr. Coleman has reduced his alcohol intake, he still drinks occasionally and has a history of regular use.\n\n4. 6C41.0 Cannabis episode use (in remission)\n\nMr. Coleman has a history of cannabis use but has quit recently.\n\n5. 6B40 Post-traumatic stress disorder (to be ruled out)\n\nWhile his PTSD Checklist score is below the cutoff, given his military background and some sleep disturbances, this should be carefully evaluated.\n\n6. 6E21 Secondary psychotic syndrome due to alcohol withdrawal (differential diagnosis)\n\nGiven his recent reduction in alcohol use, this should be considered, although the duration of symptoms and lack of other withdrawal symptoms make this less likely.\n\n7. 6C4Y Other specified disorders due to addictive behaviors\n\nThis could be considered due to his preoccupation with "vices" and feelings of guilt.\n\nAdditional factors to consider:\n\n- Possible unspecified trauma related to his military service\n- Recent religious conversion and its impact on his mental state\n- Stress from academic and church responsibilities\n- Somatic symptoms (headaches) that may be related to his psychological state\n\nA comprehensive clinical assessment would be necessary to confirm these diagnoses and rule out other possibilities. The treatment plan should address:\n\n1. Antipsychotic medication to address psychotic symptoms\n2. Comprehensive evaluation for PTSD and other trauma-related disorders\n3. Substance use assessment and potential treatment\n4. Individual therapy to address guilt, religious preoccupations, and adjustment to civilian life\n5. Family and relationship therapy to support his social network\n6. Occupational therapy to help maintain academic performance\n7. Regular monitoring of symptoms and medication side effects\n\nThe goal should be to stabilize Mr. Coleman\'s acute symptoms, address any underlying trauma or substance use issues, and support his functioning in academic and social domains. Given the recent onset and his previous high level of functioning, the prognosis could be favorable with appropriate treatment.""",
    """Based on the information provided and using the ICD-11 classification system, a diagnosis for Itsuki Daishi could include:\n\n1. 6A20 Schizophrenia\n\nThis is the primary diagnosis, supported by:\n- Positive symptoms:\n  - Delusions: persecutory (being monitored, mind control devices), grandiose (belief he will become prime minister of Japan), referential (TV reporters commenting on him)\n  - No clear hallucinations currently, though he had transient auditory experiences during cannabis use\n- Negative symptoms:\n  - Social withdrawal\n- Duration: Symptoms have persisted for at least 3 months\n- Functional decline: Irregular class attendance, declining academic performance\n- Absence of mood disorder or substance use that better explains symptoms\n\n2. 6A20.0 Schizophrenia, first episode\n\nThis specifier is appropriate because this appears to be Mr. Daishi's first presentation with these symptoms, and there's no history of prior episodes or treatment.\n\n3. 6C41.0 Cannabis episode use (in remission)\n\nMr. Daishi reported using cannabis during his trip to Japan, which led to transient psychotic-like experiences. However, he denies current use.\n\n4. 6A23 Acute and transient psychotic disorder (differential diagnosis)\n\nWhile the duration of symptoms (3 months) suggests schizophrenia, the relatively acute onset and lack of prior history make it important to consider this diagnosis as well.\n\n5. 6A24 Delusional disorder (differential diagnosis)\n\nThe prominence of delusions with relatively preserved functioning in some areas (personal hygiene, coherent speech) makes this a consideration, but the presence of negative symptoms and functional decline favor a diagnosis of schizophrenia.\n\nAdditional factors to consider:\n\n- Cultural factors: As a Japanese student in the US, cultural adjustment stress may be playing a role in the manifestation of symptoms\n- Academic stress\n- Possible underlying personality traits (described as somewhat shy)\n\nA comprehensive clinical assessment would be necessary to confirm these diagnoses and rule out other possibilities. The treatment plan should address:\n\n1. Antipsychotic medication to address psychotic symptoms\n2. Individual therapy, potentially including cognitive-behavioral therapy for psychosis\n3. Psychoeducation for Mr. Daishi and his uncle about schizophrenia\n4. Academic accommodations and support to help him continue his studies\n5. Cultural competence in treatment, considering his background\n6. Substance use assessment and education, particularly regarding cannabis\n7. Regular monitoring of symptoms and medication side effects\n8. Family involvement in treatment, possibly through video calls with his parents in Japan\n\nThe goal should be to stabilize Mr. Daishi's acute symptoms, improve his insight, and work towards restoring his previous level of academic and social functioning. Given the recent onset, relatively preserved functioning in some areas, and lack of family history, the prognosis could be favorable with appropriate treatment. However, ongoing management and support will be crucial."""
]
df['claude'] = pd.Series(l)
df.iloc[4].claude
df.to_csv('dsm_results.csv')


